<!doctype html><meta charset="utf-8">
<title>WS Sniffer</title>
<style>body{font:14px system-ui;margin:0;background:#111;color:#eee}
#bar{display:flex;gap:8px;padding:8px;background:#222;position:sticky;top:0}
#log{white-space:pre-wrap;font-family:ui-monospace,consolas,monaco;padding:8px}</style>
<div id="bar">
  <span>URL:</span>
  <input id="u" style="width:460px">
  <button id="go">Connect</button>
  <span id="st"></span>
</div>
<div id="log">(rien pour lâ€™instant)</div>
<script>
const qs=new URLSearchParams(location.search);
const DEFAULT='ws://127.0.0.1:8091/hud';
const u=document.getElementById('u'), st=document.getElementById('st'), logEl=document.getElementById('log');
u.value=qs.get('ws')||DEFAULT;
let ws;
function log(m){ const t=new Date().toLocaleTimeString(); logEl.textContent+=`[${t}] ${m}\n`; }
function connect(){
  try{
    if(ws) try{ws.close()}catch{};
    logEl.textContent='';
    ws=new WebSocket(u.value);
    ws.onopen =()=>{ log('OPEN '+u.value); st.textContent='OPEN'; };
    ws.onerror=e=>{ log('ERROR '+(e.message||e)); st.textContent='ERROR'; };
    ws.onclose =e=>{ log('CLOSE '+e.code+' '+e.reason); st.textContent='CLOSED'; };
    ws.onmessage=async ev=>{
      let txt=typeof ev.data==='string'?ev.data:await (ev.data?.text?.()||new Response(ev.data).text());
      log('MSG '+txt);
    };
  }catch(e){ log('EXC '+e); }
}
document.getElementById('go').onclick=connect;
connect();
</script>
